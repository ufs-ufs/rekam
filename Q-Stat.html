<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q-Stat - Analisis Data</title>
    <!-- CSS Dependencies -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f4f6f9;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
            color: #ffffff !important;
        }
        .navbar {
            background-color: #007bff;
        }
        .container {
            margin-top: 30px;
            margin-bottom: 30px;
        }
        .info-section {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .info-section h2 {
            margin-bottom: 20px;
            color: #007bff;
        }
        .info-section p {
            font-size: 1.1rem;
            color: #555555;
        }
        .feature-icon {
            font-size: 2rem;
            color: #007bff;
            margin-right: 15px;
        }
        .card {
            margin-bottom: 20px;
        }
        .footer {
            background-color: #ffffff;
            padding: 20px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            text-align: center;
            color: #555555;
        }
        /* Custom Scrollbar for DataTables */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #888; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555; 
        }
        /* Additional Styles for Report and Explanation */
        .report-section {
            margin-top: 20px;
        }
        .explanation-section {
            margin-top: 10px;
            padding: 15px;
            background-color: #f8f9fa;
            border-left: 5px solid #007bff;
            border-radius: 5px;
        }
        .explanation-title {
            font-weight: bold;
            color: #007bff;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark shadow">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Q-Stat (Quick Statistics)</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <!-- Future navigation items can be added here -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <!-- Placeholder for future nav items -->
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Information Section -->
        <div class="info-section">
            <h2>Selamat Datang di Q-Stat</h2>
            <p>
                Q-Stat adalah aplikasi analisis data yang dirancang untuk membantu Anda melakukan analisis statistik dasar dengan mudah dan efisien. Aplikasi ini menyediakan berbagai fitur seperti analisis deskriptif, uji statistik, visualisasi data, dan ekspor hasil analisis.
            </p>
            <div class="row">
                <div class="col-md-4 d-flex align-items-start mb-3">
                    <i class="fas fa-chart-bar feature-icon"></i>
                    <div>
                        <h5>Analisis Deskriptif</h5>
                        <p>Hitung rata-rata, median, varians, dan statistik deskriptif lainnya untuk memahami data Anda.</p>
                    </div>
                </div>
                <div class="col-md-4 d-flex align-items-start mb-3">
                    <i class="fas fa-vial feature-icon"></i>
                    <div>
                        <h5>Uji Statistik</h5>
                        <p>Lakukan berbagai uji statistik seperti T-Test, Korelasi Pearson, ANOVA, Regresi, dan Chi-Square.</p>
                    </div>
                </div>
                <div class="col-md-4 d-flex align-items-start mb-3">
                    <i class="fas fa-chart-pie feature-icon"></i>
                    <div>
                        <h5>Visualisasi Data</h5>
                        <p>Buat grafik dan diagram interaktif untuk memvisualisasikan data Anda dengan berbagai tipe grafik.</p>
                    </div>
                </div>
            </div>
            <div class="mt-4">
                <h5>Apa yang Dapat dan Tidak Dapat Dilakukan:</h5>
                <ul>
                    <li>Mengunggah dan menganalisis file CSV dengan delimiter tab atau koma.</li>
                    <li>Melakukan analisis statistik dasar dan lanjutan.</li>
                    <li>Membuat visualisasi data interaktif.</li>
                    <li>Mengekspor data dan laporan dalam format CSV dan PDF.</li>
                    <li><strong>Terbatas pada analisis statistik dasar dan tidak mendukung analisis multivariat yang kompleks.</strong></li>
                </ul>
            </div>
        </div>

        <!-- Pedoman Uji Statistik -->
        <div class="card shadow-sm">
            <div class="card-body">
                <h4 class="card-title"><i class="fas fa-book me-2"></i>Pedoman Pemilihan Uji Statistik</h4>
                <div class="accordion" id="statTestAccordion">
                    <!-- T-Test -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingTTest">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTTest" aria-expanded="false" aria-controls="collapseTTest">
                                T-Test
                            </button>
                        </h2>
                        <div id="collapseTTest" class="accordion-collapse collapse" aria-labelledby="headingTTest" data-bs-parent="#statTestAccordion">
                            <div class="accordion-body">
                                <strong>Kapan Menggunakan T-Test?</strong>
                                <ul>
                                    <li>Membandingkan rata-rata dua kelompok independen.</li>
                                    <li>Mengukur apakah ada perbedaan signifikan antara dua metode atau kondisi.</li>
                                </ul>
                                <strong>Contoh:</strong>
                                <p>Membandingkan efektivitas edukasi antara penggunaan aplikasi mobile dan metode konvensional.</p>
                            </div>
                        </div>
                    </div>
                    <!-- Korelasi Pearson -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingCorrelation">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCorrelation" aria-expanded="false" aria-controls="collapseCorrelation">
                                Korelasi Pearson
                            </button>
                        </h2>
                        <div id="collapseCorrelation" class="accordion-collapse collapse" aria-labelledby="headingCorrelation" data-bs-parent="#statTestAccordion">
                            <div class="accordion-body">
                                <strong>Kapan Menggunakan Korelasi Pearson?</strong>
                                <ul>
                                    <li>Mengukur hubungan linier antara dua variabel numerik.</li>
                                    <li>Mengevaluasi kekuatan dan arah hubungan antar variabel.</li>
                                </ul>
                                <strong>Contoh:</strong>
                                <p>Menganalisis hubungan antara frekuensi penggunaan aplikasi dan skor evaluasi hasil belajar.</p>
                            </div>
                        </div>
                    </div>
                    <!-- ANOVA -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingANOVA">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseANOVA" aria-expanded="false" aria-controls="collapseANOVA">
                                ANOVA
                            </button>
                        </h2>
                        <div id="collapseANOVA" class="accordion-collapse collapse" aria-labelledby="headingANOVA" data-bs-parent="#statTestAccordion">
                            <div class="accordion-body">
                                <strong>Kapan Menggunakan ANOVA?</strong>
                                <ul>
                                    <li>Membandingkan rata-rata lebih dari dua kelompok.</li>
                                    <li>Mengevaluasi apakah ada perbedaan signifikan antara tiga metode atau lebih.</li>
                                </ul>
                                <strong>Contoh:</strong>
                                <p>Membandingkan efektivitas edukasi antara tiga metode berbeda: aplikasi mobile, metode konvensional, dan kombinasi keduanya.</p>
                            </div>
                        </div>
                    </div>
                    <!-- Regresi -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingRegression">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRegression" aria-expanded="false" aria-controls="collapseRegression">
                                Regresi
                            </button>
                        </h2>
                        <div id="collapseRegression" class="accordion-collapse collapse" aria-labelledby="headingRegression" data-bs-parent="#statTestAccordion">
                            <div class="accordion-body">
                                <strong>Kapan Menggunakan Regresi?</strong>
                                <ul>
                                    <li>Memprediksi nilai variabel dependen berdasarkan variabel independen.</li>
                                    <li>Menganalisis hubungan kausal antara variabel.</li>
                                </ul>
                                <strong>Contoh:</strong>
                                <p>Memprediksi efektivitas edukasi berdasarkan frekuensi penggunaan aplikasi mobile.</p>
                            </div>
                        </div>
                    </div>
                    <!-- Chi-Square -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingChiSquare">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseChiSquare" aria-expanded="false" aria-controls="collapseChiSquare">
                                Chi-Square
                            </button>
                        </h2>
                        <div id="collapseChiSquare" class="accordion-collapse collapse" aria-labelledby="headingChiSquare" data-bs-parent="#statTestAccordion">
                            <div class="accordion-body">
                                <strong>Kapan Menggunakan Chi-Square?</strong>
                                <ul>
                                    <li>Menganalisis asosiasi antara dua variabel kategorikal.</li>
                                    <li>Mengevaluasi apakah distribusi kategori berbeda dari yang diharapkan.</li>
                                </ul>
                                <strong>Contoh:</strong>
                                <p>Mengevaluasi apakah ada asosiasi antara jenis kelamin dan preferensi metode edukasi.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <hr>
<!-- Contoh Format CSV untuk Penelitian Mahasiswa Kesehatan Gigi di Poltekkes -->
<div class="card shadow-sm mb-4">
    <div class="card-body">
        <h5><i class="fas fa-file-csv me-2"></i>Contoh Format File CSV</h5>
        <p>Berikut adalah contoh format file CSV yang dapat diunggah untuk penelitian mahasiswa kesehatan gigi di Poltekkes:</p>
        <div class="table-responsive">
            <table class="table table-bordered table-striped">
                <thead class="table-warning">
                    <tr>
                        <th>ID Responden</th>
                        <th>Nama</th>
                        <th>Umur</th>
                        <th>Jenis Kelamin</th>
                        <th>Program Studi</th>
                        <th>Fakultas</th>
                        <th>Semester</th>
                        <th>Penggunaan Alat Gigi</th>
                        <th>Frekuensi Pemeriksaan Gigi (per tahun)</th>
                        <th>Tingkat Kepuasan Layanan Gigi (1-5)</th>
                        <th>Pengetahuan tentang Perawatan Gigi (1-5)</th>
                        <th>Kebiasaan Menjaga Kebersihan Gigi</th>
                        <th>Masalah Gigi yang Pernah Dihadapi</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>001</td>
                        <td>Andi Saputra</td>
                        <td>20</td>
                        <td>Laki-laki</td>
                        <td>Kesehatan Gigi</td>
                        <td>Fakultas Kesehatan</td>
                        <td>4</td>
                        <td>Ya</td>
                        <td>2</td>
                        <td>4</td>
                        <td>5</td>
                        <td>Rutin menyikat gigi 2 kali sehari</td>
                        <td>Gigi berlubang</td>
                    </tr>
                    <tr>
                        <td>002</td>
                        <td>Siti Rahmawati</td>
                        <td>21</td>
                        <td>Perempuan</td>
                        <td>Kesehatan Gigi</td>
                        <td>Fakultas Kesehatan</td>
                        <td>6</td>
                        <td>Tidak</td>
                        <td>0</td>
                        <td>3</td>
                        <td>3</td>
                        <td>Sekali sehari menyikat gigi</td>
                        <td>Gusi bengkak</td>
                    </tr>
                    <!-- Tambahkan baris data sesuai kebutuhan -->
                </tbody>
            </table>
        </div>
        <p><strong>Penjelasan Kolom:</strong></p>
        <ul>
            <li><strong>ID Responden:</strong> Nomor unik untuk setiap responden.</li>
            <li><strong>Nama:</strong> Nama lengkap responden.</li>
            <li><strong>Umur:</strong> Usia responden dalam tahun.</li>
            <li><strong>Jenis Kelamin:</strong> Jenis kelamin responden (Laki-laki/Perempuan).</li>
            <li><strong>Program Studi:</strong> Program studi yang diambil oleh responden.</li>
            <li><strong>Fakultas:</strong> Fakultas tempat responden terdaftar.</li>
            <li><strong>Semester:</strong> Semester aktif responden.</li>
            <li><strong>Penggunaan Alat Gigi:</strong> Indikasi apakah responden rutin menggunakan alat gigi seperti benang gigi atau obat kumur (Ya/Tidak).</li>
            <li><strong>Frekuensi Pemeriksaan Gigi (per tahun):</strong> Jumlah rata-rata pemeriksaan gigi yang dilakukan responden dalam setahun.</li>
            <li><strong>Tingkat Kepuasan Layanan Gigi (1-5):strong> Skor kepuasan responden terhadap layanan kesehatan gigi yang diterima, diukur dari 1 (sangat tidak puas) hingga 5 (sangat puas).</li>
            <li><strong>Pengetahuan tentang Perawatan Gigi (1-5):strong> Skor pengetahuan responden mengenai perawatan gigi, diukur dari 1 (sangat kurang) hingga 5 (sangat baik).</li>
            <li><strong>Kebiasaan Menjaga Kebersihan Gigi:</strong> Deskripsi singkat mengenai kebiasaan perawatan gigi responden, seperti frekuensi menyikat gigi.</li>
            <li><strong>Masalah Gigi yang Pernah Dihadapi:</strong> Jenis masalah gigi yang pernah dialami oleh responden, seperti gigi berlubang, gusi bengkak, dll.</li>
        </ul>
        <p><strong>Catatan:</strong> Pastikan file CSV Anda memiliki header yang jelas dan konsisten. Berikut adalah contoh format dalam format teks:</p>
        <pre>
ID Responden,Nama,Umur,Jenis Kelamin,Program Studi,Fakultas,Semester,Penggunaan Alat Gigi,Frekuensi Pemeriksaan Gigi (per tahun),Tingkat Kepuasan Layanan Gigi (1-5),Pengetahuan tentang Perawatan Gigi (1-5),Kebiasaan Menjaga Kebersihan Gigi,Masalah Gigi yang Pernah Dihadapi
001,"Andi Saputra",20,Laki-laki,Kesehatan Gigi,"Fakultas Kesehatan",4,Ya,2,4,5,"Rutin menyikat gigi 2 kali sehari","Gigi berlubang"
002,"Siti Rahmawati",21,Perempuan,Kesehatan Gigi,"Fakultas Kesehatan",6,Tidak,0,3,3,"Sekali sehari menyikat gigi","Gusi bengkak"
        </pre>
        <p><strong>Tips:</strong> 
            <ul>
                <li>Gunakan tanda kutip ("") untuk mengelilingi teks yang mengandung koma atau karakter khusus.</li>
                <li>Pastikan setiap baris memiliki jumlah kolom yang sama sesuai header.</li>
                <li>Hindari nilai kosong dalam data untuk mencegah kesalahan saat parsing.</li>
                <li>Gunakan format numerik yang konsisten untuk kolom yang memerlukan angka.</li>
                <li>Periksa kembali data sebelum diunggah untuk memastikan akurasi dan konsistensi.</li>
            </ul>
        </p>
    </div>
</div>

        <!-- Upload Section -->
        <div class="card shadow-sm mt-4">
            <div class="card-body">
                <h4 class="card-title"><i class="fas fa-upload me-2"></i>Unggah File CSV</h4>
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" value="" id="enableEncoding">
                    <label class="form-check-label" for="enableEncoding">
                        Encode variabel kategorikal menjadi numerik
                    </label>
                </div>
                <input type="file" id="csvFile" class="form-control" accept=".csv">
                <small class="text-muted">File harus menggunakan delimiter tab (<code>\t</code>) atau koma (,).</small>
            </div>
        </div>

        <!-- Data Preview -->
        <div class="card shadow-sm mt-4">
            <div class="card-body">
                <h4 class="card-title"><i class="fas fa-table me-2"></i>Pratinjau Data</h4>
                <div class="table-responsive">
                    <table id="dataTable" class="table table-striped table-bordered" style="width:100%">
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Descriptive Analysis -->
        <div class="card shadow-sm mt-4">
            <div class="card-body">
                <h4 class="card-title"><i class="fas fa-chart-line me-2"></i>Analisis Deskriptif</h4>
                <div id="descriptiveAnalysis"></div>
            </div>
        </div>

        <!-- Statistical Tests -->
        <div class="card shadow-sm mt-4">
            <div class="card-body">
                <h4 class="card-title"><i class="fas fa-vials me-2"></i>Uji Statistik</h4>
                <label for="statisticalTest" class="form-label">Pilih Uji Statistik:</label>
                <select id="statisticalTest" class="form-select mb-3">
                    <option value="">-- Pilih Uji --</option>
                    <option value="t-test">T-Test</option>
                    <option value="correlation">Korelasi Pearson</option>
                    <option value="anova">ANOVA</option>
                    <option value="regression">Regresi</option>
                    <option value="chi-square">Chi-Square</option>
                </select>
                <div id="testOptions" class="mb-3"></div>
                <button id="runTest" class="btn btn-primary"><i class="fas fa-play me-2"></i>Jalankan Uji</button>
                <div id="testResults" class="mt-4"></div>
            </div>
        </div>

        <!-- Data Visualization -->
        <div class="card shadow-sm mt-4">
            <div class="card-body">
                <h4 class="card-title"><i class="fas fa-chart-pie me-2"></i>Visualisasi Data</h4>
                <div class="row">
                    <div class="col-md-3">
                        <label for="chartType" class="form-label">Tipe Grafik:</label>
                        <select id="chartType" class="form-select">
                            <option value="bar">Diagram Batang</option>
                            <option value="line">Diagram Garis</option>
                            <option value="pie">Diagram Pie</option>
                            <option value="histogram">Histogram</option>
                            <option value="scatter">Scatter Plot</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="chartColumn" class="form-label">Kolom:</label>
                        <select id="chartColumn" class="form-select"></select>
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <label for="scatterY" class="form-label">Kolom Y (Scatter):</label>
                        <select id="scatterY" class="form-select">
                            <option value="">-- Pilih Variabel Y --</option>
                        </select>
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <button id="generateChart" class="btn btn-secondary w-100"><i class="fas fa-chart-area me-2"></i>Generate Grafik</button>
                    </div>
                </div>
                <div class="chart-container mt-4">
                    <canvas id="chartCanvas"></canvas>
                </div>
            </div>
        </div>

        <!-- Export Section -->
        <div class="card shadow-sm mt-4">
            <div class="card-body">
                <h4 class="card-title"><i class="fas fa-file-export me-2"></i>Ekspor Data</h4>
                <button id="exportCSV" class="btn btn-success me-2"><i class="fas fa-file-csv me-2"></i>Ekspor CSV</button>
                <button id="exportPDF" class="btn btn-danger"><i class="fas fa-file-pdf me-2"></i>Ekspor PDF</button>
            </div>
        </div>

        <!-- Summary Report -->
        <div class="card shadow-sm mt-4">
            <div class="card-body">
                <h4 class="card-title"><i class="fas fa-clipboard-check me-2"></i>Laporan/Rangkuman Hasil Analisis</h4>
                <ul id="summaryList">
                    <!-- Rangkuman akan ditambahkan di sini -->
                </ul>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="container">
            &copy; 2024 Q-Stat By: UFS. Semua hak cipta dilindungi.
        </div>
    </div>

    <!-- Modal for Encoding Mapping -->
    <div class="modal fade" id="encodingModal" tabindex="-1" aria-labelledby="encodingModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="encodingModalLabel">Mapping Encoding Variabel Kategorikal</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <!-- Mapping Tables will be inserted here -->
            <div id="encodingMappings"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
          </div>
        </div>
      </div>
    </div>

    <!-- JavaScript Dependencies -->
    <!-- Load jQuery terlebih dahulu -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- Load Lodash -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <!-- DataTables Bootstrap 5 -->
    <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.5/js/dataTables.bootstrap5.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Simple Statistics (Menggunakan versi 7.6.0) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simple-statistics/7.6.0/simple-statistics.min.js"></script>
    <!-- jStat -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstat/1.9.4/jstat.min.js"></script>
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- PapaParse untuk parsing CSV -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <!-- FontAwesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Pastikan bahwa library simple-statistics dan jStat telah dimuat
            console.log('simple-statistics library:', ss);
            console.log('jStat library:', jStat);

            let originalData = [];
            let encodedData = [];
            let tableColumns = [];
            let chartInstance = null;
            let encodingMaps = {}; // To store label encoding for each categorical column
            let columnTypes = {}; // To store the type of each column
            let isEncodingEnabled = false; // Flag to check if encoding is enabled

            // Template explanations untuk setiap uji statistik
            const explanations = {
                "t-test": (result, params) => `
                    <div class="explanation-section">
                        <p class="explanation-title">Pernyataan tersebut berarti:</p>
                        <p><strong>T-Test:</strong> Analisis statistik digunakan untuk mengetahui apakah terdapat perbedaan signifikan antara rata-rata dua kelompok independen, yaitu <strong>${params.group1}</strong> dan <strong>${params.group2}</strong>.</p>
                        <p><strong>t-Statistik:</strong> Nilai t-statistik sebesar <strong>${result['t-Statistik']}</strong> menunjukkan seberapa jauh perbedaan rata-rata antara dua grup dari nol.</p>
                        <p><strong>p-Value:</strong> Nilai p sebesar <strong>${result['p-Value']}</strong> menunjukkan probabilitas mendapatkan hasil seperti ini jika hipotesis nol benar (tidak ada perbedaan). Karena p-value < 0.05, kita menolak hipotesis nol.</p>
                        <p><strong>Confidence Interval (95%):</strong> [${result['CI Lower']}, ${result['CI Upper']}], yang berarti bahwa kita 95% yakin bahwa perbedaan rata-rata sebenarnya berada dalam rentang tersebut.</p>
                        <p><strong>Levene's Test for Equality of Variances:</strong> ${result['Levene\'s Test']}, yang menunjukkan apakah variansi antar grup homogen.</p>
                        <p><strong>Kesimpulan:</strong> T-Test menunjukkan bahwa ada perbedaan signifikan dalam efektivitas edukasi antara <strong>${params.group1}</strong> dan <strong>${params.group2}</strong> (p < 0.05).</p>
                    </div>
                `,
                "correlation": (result, params) => `
                    <div class="explanation-section">
                        <p class="explanation-title">Pernyataan tersebut berarti:</p>
                        <p><strong>Korelasi Pearson:</strong> Analisis statistik digunakan untuk mengukur hubungan linier antara dua variabel numerik, yaitu <strong>${params.corrX}</strong> dan <strong>${params.corrY}</strong>.</p>
                        <p><strong>Koefisien Korelasi Pearson:</strong> Nilai koefisien korelasi sebesar <strong>${result['Koefisien Korelasi Pearson']}</strong> menunjukkan kekuatan dan arah hubungan antara kedua variabel.</p>
                        <p><strong>p-Value:</strong> Nilai p sebesar <strong>${result['p-Value']}</strong> menunjukkan probabilitas mendapatkan hasil seperti ini jika tidak ada korelasi. Karena p-value < 0.05, kita menyimpulkan bahwa terdapat hubungan yang signifikan.</p>
                        <p><strong>Kesimpulan:</strong> Korelasi Pearson antara <strong>${params.corrX}</strong> dan <strong>${params.corrY}</strong> adalah <strong>${result['Koefisien Korelasi Pearson']}</strong> (p < 0.05), menunjukkan hubungan yang signifikan.</p>
                    </div>
                `,
                "anova": (result, params) => `
                    <div class="explanation-section">
                        <p class="explanation-title">Pernyataan tersebut berarti:</p>
                        <p><strong>ANOVA:</strong> Analisis statistik digunakan untuk mengetahui apakah terdapat perbedaan signifikan antara rata-rata lebih dari dua kelompok, yaitu <strong>${params.groups.join(', ')}</strong>.</p>
                        <p><strong>F-Statistik:</strong> Nilai F-statistik sebesar <strong>${result['F-Statistik']}</strong> menunjukkan seberapa besar variabilitas antar grup dibandingkan dengan variabilitas dalam grup.</p>
                        <p><strong>p-Value:</strong> Nilai p sebesar <strong>${result['p-Value']}</strong> menunjukkan probabilitas mendapatkan hasil seperti ini jika tidak ada perbedaan rata-rata. Karena p-value < 0.05, kita menolak hipotesis nol.</p>
                        <p><strong>Levene's Test for Equality of Variances:</strong> ${result['Levene\'s Test']}, yang menunjukkan apakah variansi antar grup homogen.</p>
                        <p><strong>Kesimpulan:</strong> ANOVA menunjukkan ada perbedaan signifikan dalam efektivitas edukasi antara grup: <strong>${params.groups.join(', ')}</strong> (p < 0.05).</p>
                    </div>
                `,
                "regression": (result, params) => {
                    const isSignificant = parseFloat(result['p-Value']) < 0.05;
                    return `
                        <div class="explanation-section">
                            <p class="explanation-title">Pernyataan tersebut berarti:</p>
                            <p><strong>Regresi:</strong> Analisis statistik digunakan untuk memprediksi nilai variabel dependen (<strong>${params.regressY}</strong>) berdasarkan variabel independen (<strong>${params.regressX}</strong>).</p>
                            <p><strong>Slope (m):</strong> Nilai slope sebesar <strong>${result['Slope (m)']}</strong> menunjukkan perubahan rata-rata pada variabel dependen untuk setiap unit perubahan pada variabel independen.</p>
                            <p><strong>Intercept (b):</strong> Nilai intercept sebesar <strong>${result['Intercept (b)']}</strong> adalah nilai variabel dependen saat variabel independen bernilai nol.</p>
                            <p><strong>R-squared:</strong> Nilai R² sebesar <strong>${result['R-squared']}</strong> menunjukkan seberapa besar variabel independen (<strong>${params.regressX}</strong>) dapat menjelaskan variasi dalam variabel dependen (<strong>${params.regressY}</strong>).</p>
                            <p><strong>Confidence Interval for Slope (95%):</strong> [${result['CI Lower Slope']}, ${result['CI Upper Slope']}], yang berarti bahwa kita 95% yakin bahwa slope sebenarnya berada dalam rentang tersebut.</p>
                            <p><strong>p-Value:</strong> Nilai p sebesar <strong>${result['p-Value']}</strong> menunjukkan probabilitas mendapatkan hasil seperti ini jika tidak ada hubungan. Karena p-value < 0.05, kita menyimpulkan bahwa ${params.regressX} adalah prediktor signifikan terhadap ${params.regressY}.</p>
                            <p><strong>Kesimpulan:</strong> Regresi menunjukkan bahwa <strong>${params.regressX}</strong> adalah prediktor signifikan efektivitas edukasi (<strong>${params.regressY}</strong>) dengan R² = <strong>${result['R-squared']}</strong>.</p>
                        </div>
                    `;
                },
                "chi-square": (result, params) => {
                    const isSignificant = parseFloat(result['p-Value']) < 0.05;
                    const conclusion = isSignificant 
                        ? `Chi-Square Test menunjukkan terdapat asosiasi signifikan antara <strong>${params.chiX}</strong> dan <strong>${params.chiY}</strong> (p < 0.05).` 
                        : `Chi-Square Test tidak menunjukkan adanya asosiasi signifikan antara <strong>${params.chiX}</strong> dan <strong>${params.chiY}</strong> (p >= 0.05).`;
                    return `
                        <div class="explanation-section">
                            <p class="explanation-title">Pernyataan tersebut berarti:</p>
                            <p><strong>Chi-Square:</strong> Analisis statistik digunakan untuk menguji asosiasi antara dua variabel kategorikal, yaitu <strong>${params.chiX}</strong> dan <strong>${params.chiY}</strong>.</p>
                            <p><strong>Chi-Square Statistik:</strong> Nilai Chi-Square sebesar <strong>${result['Chi-Square Statistik']}</strong> menunjukkan seberapa jauh distribusi yang diamati dari distribusi yang diharapkan.</p>
                            <p><strong>Degrees of Freedom:</strong> Derajat kebebasan sebesar <strong>${result['Degrees of Freedom']}</strong> adalah parameter yang digunakan untuk menentukan distribusi Chi-Square.</p>
                            <p><strong>p-Value:</strong> Nilai p sebesar <strong>${result['p-Value']}</strong> menunjukkan probabilitas mendapatkan hasil seperti ini jika tidak ada asosiasi. Karena p-value ${parseFloat(result['p-Value']) < 0.05 ? '< 0.05' : '>= 0.05'}, kita ${parseFloat(result['p-Value']) < 0.05 ? 'menolak hipotesis nol' : 'tidak menolak hipotesis nol'}.</p>
                            <p><strong>Kesimpulan:</strong> ${conclusion}</p>
                        </div>
                    `;
                }
            };

            document.getElementById('csvFile').addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (!file) return;

                Papa.parse(file, {
                    header: true,
                    delimiter: "", // Auto-detect delimiter
                    skipEmptyLines: true,
                    complete: function(results) {
                        if (results.errors.length) {
                            alert('Terjadi kesalahan saat parsing file CSV: ' + results.errors[0].message);
                            console.error(results.errors);
                            return;
                        }
                        parseCSV(results.data);
                    }
                });
            });

            function sumArray(arr) {
                return arr.reduce((a, b) => a + b, 0);
            }

            function validateHeaders(headers) {
                if (new Set(headers).size !== headers.length) {
                    alert('Header CSV tidak unik. Pastikan setiap kolom memiliki nama yang berbeda.');
                    return false;
                }
                return true;
            }

            function validateData(rows, headers) {
                return rows.every(row => headers.every(header => row[header] !== undefined && row[header] !== null && row[header].toString().trim() !== ''));
            }

            function parseCSV(data) {
                if (data.length === 0) {
                    alert('File CSV tidak memiliki data.');
                    return;
                }

                const headers = Object.keys(data[0]).map(header => header.trim());

                if (!validateHeaders(headers)) return;

                if (!validateData(data, headers)) {
                    alert('Data CSV mengandung nilai kosong atau tidak sesuai format.');
                    return;
                }

                originalData = data.map(record => {
                    const obj = {};
                    headers.forEach(header => {
                        const value = record[header] ? record[header].toString().trim() : null;
                        obj[header] = value === '' ? null : value;
                    });
                    return obj;
                });

                // Check if encoding is enabled
                isEncodingEnabled = document.getElementById('enableEncoding').checked;

                // Detect column types and encode categorical data if enabled
                detectAndEncodeData(headers, originalData);

                // Display original or encoded data
                displayTable(headers, isEncodingEnabled ? encodedData : originalData);

                // Populate chart columns
                populateChartColumns();

                // Generate descriptive analysis
                generateDescriptiveAnalysis();

                // Suggest statistical tests
                suggestStatisticalTests();

                // If encoding is enabled, display the mapping
                if (isEncodingEnabled) {
                    displayEncodingMappings();
                }
            }

            function detectAndEncodeData(headers, data) {
                if (isEncodingEnabled) {
                    updateEncodingMaps(headers, data);
                    encodedData = data.map(row => {
                        const newRow = {};
                        headers.forEach(header => {
                            const value = row[header];
                            if (columnTypes[header] === 'categorical') {
                                newRow[header] = encodingMaps[header][value] !== undefined ? encodingMaps[header][value] : null;
                            } else if (columnTypes[header] === 'numerical') {
                                newRow[header] = value !== null ? parseFloat(value) : null;
                            } else {
                                newRow[header] = value;
                            }
                        });
                        return newRow;
                    });

                    // Tetap kategorikal meskipun di-encode
                    headers.forEach(header => {
                        if (columnTypes[header] === 'categorical') {
                            columnTypes[header] = 'categorical';
                        }
                    });
                } else {
                    // Jika encoding tidak diaktifkan, tandai semua kolom sesuai tipe aslinya
                    headers.forEach(header => {
                        const isNumeric = data.every(row => {
                            const val = row[header];
                            return val === null || !isNaN(parseFloat(val));
                        });
                        columnTypes[header] = isNumeric ? 'numerical' : 'categorical';
                    });
                }
            }

            function updateEncodingMaps(headers, data) {
                headers.forEach(header => {
                    // Check if the column is numeric
                    const isNumeric = data.every(row => {
                        const val = row[header];
                        return val === null || !isNaN(parseFloat(val));
                    });

                    if (!isNumeric) {
                        columnTypes[header] = 'categorical';
                        if (!encodingMaps[header]) {
                            encodingMaps[header] = {};
                        }
                        const uniqueValues = _.uniq(data.map(row => row[header]).filter(val => val !== null));
                        uniqueValues.forEach((val, idx) => {
                            if (!(val in encodingMaps[header])) {
                                encodingMaps[header][val] = idx; // Start encoding from 0
                            }
                        });
                    } else {
                        columnTypes[header] = 'numerical';
                    }
                });
            }

            function displayTable(headers, data) {
                // Define DataTables columns
                tableColumns = headers.map(header => ({ title: header, data: header }));

                // Initialize DataTables
                $('#dataTable').DataTable({
                    destroy: true,
                    data: data,
                    columns: tableColumns,
                    paging: true,
                    searching: true,
                    info: true,
                    language: {
                        emptyTable: "Tidak ada data tersedia",
                        loadingRecords: "Memuat...",
                        processing: "Sedang diproses...",
                        search: "Cari:",
                        lengthMenu: "Tampilkan _MENU_ entri",
                        zeroRecords: "Tidak ditemukan data yang cocok",
                        paginate: {
                            first: "Pertama",
                            last: "Terakhir",
                            next: "Selanjutnya",
                            previous: "Sebelumnya"
                        },
                    }
                });
            }

            function populateChartColumns() {
                const chartColumnSelect = document.getElementById('chartColumn');
                chartColumnSelect.innerHTML = '';
                const numericalCols = getNumericalColumns();
                numericalCols.forEach(col => {
                    const option = document.createElement('option');
                    option.value = col;
                    option.textContent = col;
                    chartColumnSelect.appendChild(option);
                });

                // Juga populate scatter Y jika scatter dipilih
                const scatterYSelect = document.getElementById('scatterY');
                scatterYSelect.innerHTML = '<option value="">-- Pilih Variabel Y --</option>';
                numericalCols.forEach(col => {
                    const option = document.createElement('option');
                    option.value = col;
                    option.textContent = col;
                    scatterYSelect.appendChild(option);
                });
            }

            function generateDescriptiveAnalysis() {
                const analysisDiv = document.getElementById('descriptiveAnalysis');
                analysisDiv.innerHTML = '';

                tableColumns.forEach(col => {
                    const columnName = col.title;
                    const isNumeric = columnTypes[columnName] === 'numerical';

                    if (!isNumeric) return; // Skip categorical columns

                    const values = isEncodingEnabled ? encodedData.map(row => row[columnName]).filter(val => typeof val === 'number') : originalData.map(row => row[columnName]).filter(val => typeof val === 'number');

                    if (values.length === 0) return;

                    const stats = {
                        Mean: ss.mean(values).toFixed(2),
                        Median: ss.median(values).toFixed(2),
                        Variance: ss.variance(values).toFixed(2),
                        StdDev: ss.standardDeviation(values).toFixed(2),
                        Min: Math.min(...values).toFixed(2),
                        Max: Math.max(...values).toFixed(2),
                    };

                    let html = `<h5>${columnName}</h5><table class="table table-bordered"><tbody>`;
                    for (let [key, value] of Object.entries(stats)) {
                        html += `<tr><td>${key}</td><td>${value}</td></tr>`;
                    }
                    html += `</tbody></table>`;
                    analysisDiv.innerHTML += html;
                });
            }

            document.getElementById('statisticalTest').addEventListener('change', function () {
                const selectedTest = this.value;
                const testOptionsDiv = document.getElementById('testOptions');
                testOptionsDiv.innerHTML = '';

                if (selectedTest === 't-test') {
                    // T-Test requires two numerical groups
                    const numericalCols = getNumericalColumns();
                    const html = `
                        <label for="group1" class="form-label">Grup 1:</label>
                        <select id="group1" class="form-select mb-2">
                            ${populateOptions(numericalCols)}
                        </select>
                        <label for="group2" class="form-label">Grup 2:</label>
                        <select id="group2" class="form-select">
                            ${populateOptions(numericalCols)}
                        </select>
                    `;
                    testOptionsDiv.innerHTML = html;
                } else if (selectedTest === 'correlation') {
                    // Correlation requires two numerical variables
                    const numericalCols = getNumericalColumns();
                    const html = `
                        <label for="corrX" class="form-label">Variabel X:</label>
                        <select id="corrX" class="form-select mb-2">
                            ${populateOptions(numericalCols)}
                        </select>
                        <label for="corrY" class="form-label">Variabel Y:</label>
                        <select id="corrY" class="form-select">
                            ${populateOptions(numericalCols)}
                        </select>
                    `;
                    testOptionsDiv.innerHTML = html;
                } else if (selectedTest === 'anova') {
                    // ANOVA requires at least two numerical groups
                    const numericalCols = getNumericalColumns();
                    if (numericalCols.length < 2) {
                        testOptionsDiv.innerHTML = '<p class="text-danger">Minimal dua grup numerik diperlukan untuk ANOVA.</p>';
                        return;
                    }
                    const html = `
                        <label for="anovaGroups" class="form-label">Pilih Grup (minimal 2):</label>
                        <select id="anovaGroups" class="form-select mb-2" multiple>
                            ${populateOptions(numericalCols)}
                        </select>
                        <small class="text-muted">Tahan Ctrl (Windows) atau Cmd (Mac) untuk memilih multiple.</small>
                    `;
                    testOptionsDiv.innerHTML = html;
                } else if (selectedTest === 'regression') {
                    // Regression requires one numerical independent variable and one numerical dependent variable
                    const numericalCols = getNumericalColumns();
                    const html = `
                        <label for="regressX" class="form-label">Variabel Independen (X):</label>
                        <select id="regressX" class="form-select mb-2">
                            ${populateOptions(numericalCols)}
                        </select>
                        <label for="regressY" class="form-label">Variabel Dependen (Y):</label>
                        <select id="regressY" class="form-select">
                            ${populateOptions(numericalCols)}
                        </select>
                    `;
                    testOptionsDiv.innerHTML = html;
                } else if (selectedTest === 'chi-square') {
                    // Chi-Square requires two categorical variables
                    const categoricalCols = getCategoricalColumns();
                    if (categoricalCols.length < 2) {
                        testOptionsDiv.innerHTML = '<p class="text-danger">Minimal dua variabel kategorikal diperlukan untuk Chi-Square.</p>';
                        return;
                    }
                    const html = `
                        <label for="chiX" class="form-label">Variabel X:</label>
                        <select id="chiX" class="form-select mb-2">
                            ${populateOptions(categoricalCols)}
                        </select>
                        <label for="chiY" class="form-label">Variabel Y:</label>
                        <select id="chiY" class="form-select">
                            ${populateOptions(categoricalCols)}
                        </select>
                    `;
                    testOptionsDiv.innerHTML = html;
                }
            });

            function getNumericalColumns() {
                return tableColumns.filter(col => columnTypes[col.title] === 'numerical').map(col => col.title);
            }

            function getCategoricalColumns() {
                return tableColumns.filter(col => columnTypes[col.title] === 'categorical').map(col => col.title);
            }

            function populateOptions(columns) {
                return columns.map(col => `<option value="${col}">${col}</option>`).join('');
            }

            document.getElementById('runTest').addEventListener('click', () => {
                const selectedTest = document.getElementById('statisticalTest').value;
                if (!selectedTest) {
                    alert('Silakan pilih uji statistik terlebih dahulu.');
                    return;
                }

                try {
                    let result = {};
                    let params = {};
                    if (selectedTest === 't-test') {
                        const group1Element = document.getElementById('group1');
                        const group2Element = document.getElementById('group2');

                        if (!group1Element || !group2Element) {
                            alert('Grup 1 atau Grup 2 tidak ditemukan.');
                            return;
                        }

                        const group1Col = group1Element.value;
                        const group2Col = group2Element.value;

                        if (!group1Col || !group2Col) {
                            alert('Silakan pilih kedua grup untuk T-Test.');
                            return;
                        }

                        const group1 = isEncodingEnabled 
                            ? encodedData.map(row => row[group1Col]).filter(val => typeof val === 'number') 
                            : originalData.map(row => parseFloat(row[group1Col])).filter(val => !isNaN(val));
                        const group2 = isEncodingEnabled 
                            ? encodedData.map(row => row[group2Col]).filter(val => typeof val === 'number') 
                            : originalData.map(row => parseFloat(row[group2Col])).filter(val => !isNaN(val));

                        if (group1.length < 2 || group2.length < 2) {
                            alert('Masing-masing grup harus memiliki minimal 2 data numerik.');
                            return;
                        }

                        // Hitung Levene's Test untuk homogenitas varians
                        const leveneResult = jStat.levenesTest(group1, group2, 0.05);
                        const isHomogeneous = leveneResult.pValue > 0.05;

                        // Validasi Normalitas menggunakan Shapiro-Wilk (jStat belum mendukung, gunakan pendekatan alternatif)
                        if (!checkNormality(group1) || !checkNormality(group2)) {
                            alert('Data tidak terdistribusi normal. Pertimbangkan menggunakan uji non-parametrik.');
                            return;
                        }

                        // Validasi Homogenitas Variansi
                        if (!isHomogeneous) {
                            alert('Variansi antar grup tidak homogen. Pertimbangkan menggunakan uji non-parametrik.');
                            return;
                        }

                        // Calculate Means
                        const mean1 = ss.mean(group1);
                        const mean2 = ss.mean(group2);

                        // Calculate Variances
                        const var1 = ss.variance(group1);
                        const var2 = ss.variance(group2);

                        // Calculate pooled standard deviation
                        const n1 = group1.length;
                        const n2 = group2.length;
                        const sp = Math.sqrt(((n1 - 1) * var1 + (n2 - 1) * var2) / (n1 + n2 - 2));

                        // Calculate standard error
                        const se = sp * Math.sqrt(1/n1 + 1/n2);

                        // Calculate t-statistic
                        const tStat = (mean1 - mean2) / se;

                        // Degrees of Freedom
                        const df = n1 + n2 - 2;

                        // Calculate p-value (two-tailed) menggunakan jStat
                        const pVal = 2 * (1 - jStat.studentt.cdf(Math.abs(tStat), df));

                        // Calculate Confidence Interval (95%)
                        const ciLower = (mean1 - mean2) - jStat.studentt.inv(0.975, df) * se;
                        const ciUpper = (mean1 - mean2) + jStat.studentt.inv(0.975, df) * se;

                        result = { 
                            't-Statistik': tStat.toFixed(4), 
                            'p-Value': pVal.toFixed(4),
                            'CI Lower': ciLower.toFixed(4),
                            'CI Upper': ciUpper.toFixed(4),
                            'Levene\'s Test': isHomogeneous ? 'Variansi Homogen (p > 0.05)' : 'Variansi Tidak Homogen (p ≤ 0.05)'
                        };
                        params = { group1: group1Col, group2: group2Col };
                        displayTestResults(selectedTest, `T-Test antara ${group1Col} dan ${group2Col}`, result, params);

                    } else if (selectedTest === 'correlation') {
                        const corrXElement = document.getElementById('corrX');
                        const corrYElement = document.getElementById('corrY');

                        if (!corrXElement || !corrYElement) {
                            alert('Variabel X atau Y tidak ditemukan.');
                            return;
                        }

                        const corrX = corrXElement.value;
                        const corrY = corrYElement.value;

                        if (!corrX || !corrY) {
                            alert('Silakan pilih kedua variabel untuk Korelasi.');
                            return;
                        }

                        const x = isEncodingEnabled 
                            ? encodedData.map(row => row[corrX]).filter(val => typeof val === 'number') 
                            : originalData.map(row => parseFloat(row[corrX])).filter(val => !isNaN(val));
                        const y = isEncodingEnabled 
                            ? encodedData.map(row => row[corrY]).filter(val => typeof val === 'number') 
                            : originalData.map(row => parseFloat(row[corrY])).filter(val => !isNaN(val));

                        if (x.length < 2 || y.length < 2) {
                            alert('Masing-masing variabel harus memiliki minimal 2 data numerik.');
                            return;
                        }

                        // Validasi Normalitas
                        if (!checkNormality(x) || !checkNormality(y)) {
                            alert('Data tidak terdistribusi normal. Pertimbangkan menggunakan uji non-parametrik.');
                            return;
                        }

                        // Calculate Pearson Correlation Coefficient menggunakan jStat
                        const corrCoeff = jStat.corrcoeff(x, y);

                        // Calculate t-statistic
                        const n = x.length;
                        const t = corrCoeff * Math.sqrt((n - 2) / (1 - corrCoeff * corrCoeff));

                        // Calculate p-value (two-tailed)
                        const pVal = 2 * (1 - jStat.studentt.cdf(Math.abs(t), n - 2));

                        result = { 'Koefisien Korelasi Pearson': corrCoeff.toFixed(4), 'p-Value': pVal.toFixed(4) };
                        params = { corrX: corrX, corrY: corrY };
                        displayTestResults(selectedTest, `Korelasi Pearson antara ${corrX} dan ${corrY}`, result, params);
                        
                    } else if (selectedTest === 'anova') {
                        const anovaSelect = document.getElementById('anovaGroups');
                        const selectedOptions = Array.from(anovaSelect.selectedOptions).map(option => option.value);

                        if (selectedOptions.length < 2) {
                            alert('Silakan pilih minimal dua grup untuk ANOVA.');
                            return;
                        }

                        const groups = selectedOptions.map(group => isEncodingEnabled 
                            ? encodedData.map(row => row[group]).filter(val => typeof val === 'number') 
                            : originalData.map(row => parseFloat(row[group])).filter(val => !isNaN(val))
                        );

                        const groupSizes = groups.map(group => group.length);
                        if (groupSizes.some(size => size < 2)) {
                            alert('Setiap grup harus memiliki minimal 2 data numerik.');
                            return;
                        }

                        // Hitung Levene's Test untuk homogenitas varians
                        const leveneResult = jStat.levenesTest(...groups, 0.05);
                        const isHomogeneous = leveneResult.pValue > 0.05;

                        // Validasi Normalitas
                        const normal = groups.every(group => checkNormality(group));
                        if (!normal) {
                            alert('Salah satu atau lebih grup tidak terdistribusi normal. Pertimbangkan menggunakan uji non-parametrik.');
                            return;
                        }

                        // Validasi Homogenitas Varians
                        if (!isHomogeneous) {
                            alert('Variansi antar grup tidak homogen. Pertimbangkan menggunakan uji non-parametrik.');
                            return;
                        }

                        // Calculate ANOVA F-statistic menggunakan jStat
                        const anovaResult = jStat.anovaftest(groups);

                        // Degrees of Freedom
                        const dfBetween = selectedOptions.length - 1;
                        const dfWithin = groups.reduce((acc, group) => acc + (group.length - 1), 0);

                        // Calculate p-value
                        const pVal = 1 - jStat.f.cdf(anovaResult, dfBetween, dfWithin);

                        result = { 
                            'F-Statistik': anovaResult.toFixed(4), 
                            'p-Value': pVal.toFixed(4),
                            'Levene\'s Test': isHomogeneous ? 'Variansi Homogen (p > 0.05)' : 'Variansi Tidak Homogen (p ≤ 0.05)'
                        };
                        params = { groups: selectedOptions };
                        displayTestResults(selectedTest, `ANOVA antara grup: ${selectedOptions.join(', ')}`, result, params);

                    } else if (selectedTest === 'regression') {
                        const regressXElement = document.getElementById('regressX');
                        const regressYElement = document.getElementById('regressY');

                        if (!regressXElement || !regressYElement) {
                            alert('Variabel Independen (X) atau Dependen (Y) tidak ditemukan.');
                            return;
                        }

                        const regressX = regressXElement.value;
                        const regressY = regressYElement.value;

                        if (!regressX || !regressY) {
                            alert('Silakan pilih kedua variabel untuk Regresi.');
                            return;
                        }

                        const x = isEncodingEnabled 
                            ? encodedData.map(row => row[regressX]).filter(val => typeof val === 'number') 
                            : originalData.map(row => parseFloat(row[regressX])).filter(val => !isNaN(val));
                        const y = isEncodingEnabled 
                            ? encodedData.map(row => row[regressY]).filter(val => typeof val === 'number') 
                            : originalData.map(row => parseFloat(row[regressY])).filter(val => !isNaN(val));

                        if (x.length < 2 || y.length < 2) {
                            alert('Masing-masing variabel harus memiliki minimal 2 data numerik.');
                            return;
                        }

                        if (x.length !== y.length) {
                            alert('Jumlah data X dan Y harus sama.');
                            return;
                        }

                        // Validasi varians X tidak nol
                        const varianceX = ss.variance(x);
                        if (varianceX === 0) {
                            alert('Variabel independen (X) memiliki varians nol. Regresi tidak dapat dilakukan.');
                            return;
                        }

                        // Calculate Linear Regression menggunakan Simple Statistics
                        try {
                            const lr = ss.linearRegression(x.map((xi, i) => [xi, y[i]]));
                            const slope = lr.m;
                            const intercept = lr.b;
                            const regressionLine = ss.linearRegressionLine(lr);
                            const rSquared = ss.rSquared(x.map((xi, i) => [xi, y[i]]), regressionLine);

                            // Calculate residuals
                            const residuals = y.map((yi, i) => yi - regressionLine(x[i]));
                            // Validasi Normalitas Residual menggunakan Uji Kolmogorov-Smirnov
                            if (!checkNormality(residuals)) {
                                alert('Residual tidak terdistribusi normal. Pertimbangkan menggunakan metode analisis lain.');
                                return;
                            }

                            // Calculate standard error of slope
                            const slopeStdErr = calculateSlopeStdErr(x, y, slope, intercept);
                            const tStat = slope / slopeStdErr;
                            const df = x.length - 2;
                            const pValReg = 2 * (1 - jStat.studentt.cdf(Math.abs(tStat), df));

                            // Confidence Interval untuk slope
                            const tCritical = jStat.studentt.inv(0.975, df);
                            const ciLowerSlope = slope - tCritical * slopeStdErr;
                            const ciUpperSlope = slope + tCritical * slopeStdErr;

                            result = {
                                'Slope (m)': slope.toFixed(4),
                                'Intercept (b)': intercept.toFixed(4),
                                'R-squared': rSquared.toFixed(4),
                                'p-Value': pValReg.toFixed(4),
                                'CI Lower Slope': ciLowerSlope.toFixed(4),
                                'CI Upper Slope': ciUpperSlope.toFixed(4)
                            };
                            params = { regressX: regressX, regressY: regressY };
                            displayTestResults(selectedTest, `Regresi antara ${regressX} (X) dan ${regressY} (Y)`, result, params);
                        } catch (error) {
                            console.error('Error dalam menghitung regresi:', error);
                            alert('Terjadi kesalahan saat menghitung regresi.');
                            return;
                        }

                    } else if (selectedTest === 'chi-square') {
                        const chiXElement = document.getElementById('chiX');
                        const chiYElement = document.getElementById('chiY');

                        if (!chiXElement || !chiYElement) {
                            alert('Variabel X atau Y tidak ditemukan.');
                            return;
                        }

                        const chiX = chiXElement.value;
                        const chiY = chiYElement.value;

                        if (!chiX || !chiY) {
                            alert('Silakan pilih kedua variabel untuk Chi-Square.');
                            return;
                        }

                        const x = isEncodingEnabled 
                            ? encodedData.map(row => row[chiX]).filter(val => val !== null)
                            : originalData.map(row => row[chiX]).filter(val => val !== null);
                        const y = isEncodingEnabled 
                            ? encodedData.map(row => row[chiY]).filter(val => val !== null)
                            : originalData.map(row => row[chiY]).filter(val => val !== null);

                        if (x.length !== y.length) {
                            alert('Jumlah data variabel X dan Y harus sama.');
                            return;
                        }

                        // Create contingency table
                        const categoriesX = isEncodingEnabled 
                            ? Object.keys(encodingMaps[chiX] || {})
                            : _.uniq(x);
                        const categoriesY = isEncodingEnabled 
                            ? Object.keys(encodingMaps[chiY] || {})
                            : _.uniq(y);

                        const contingencyTable = {};
                        categoriesX.forEach(catX => {
                            contingencyTable[catX] = {};
                            categoriesY.forEach(catY => {
                                contingencyTable[catX][catY] = 0;
                            });
                        });

                        for (let i = 0; i < x.length; i++) {
                            const catX = isEncodingEnabled ? getKeyByValue(encodingMaps[chiX], x[i]) : x[i];
                            const catY = isEncodingEnabled ? getKeyByValue(encodingMaps[chiY], y[i]) : y[i];
                            if (catX !== undefined && catY !== undefined) {
                                contingencyTable[catX][catY] += 1;
                            }
                        }

                        // Convert contingency table to array format
                        const tableArray = [];
                        categoriesX.forEach(catX => {
                            const row = [];
                            categoriesY.forEach(catY => {
                                row.push(contingencyTable[catX][catY]);
                            });
                            tableArray.push(row);
                        });

                        // Calculate row and column totals
                        const rowTotals = tableArray.map(row => sumArray(row));
                        const colTotals = categoriesY.map((_, j) => sumArray(tableArray.map(row => row[j])));
                        const total = sumArray(rowTotals);

                        // Validate expected values >=1
                        const valid = validateExpectedValues(tableArray, rowTotals, colTotals, total);
                        if (!valid) {
                            return;
                        }

                        // Calculate Chi-Square statistic
                        let chiSquareStat = 0;
                        for (let i = 0; i < categoriesX.length; i++) {
                            for (let j = 0; j < categoriesY.length; j++) {
                                const observed = tableArray[i][j];
                                const expected = (rowTotals[i] * colTotals[j]) / total;
                                chiSquareStat += Math.pow(observed - expected, 2) / expected;
                            }
                        }

                        // Degrees of Freedom
                        const df = (categoriesX.length - 1) * (categoriesY.length - 1);

                        // Calculate p-value
                        const pVal = 1 - jStat.chisquare.cdf(chiSquareStat, df);

                        result = { 'Chi-Square Statistik': chiSquareStat.toFixed(4), 'Degrees of Freedom': df, 'p-Value': pVal.toFixed(4) };
                        params = { chiX: chiX, chiY: chiY };
                        displayTestResults(selectedTest, `Chi-Square Test antara ${chiX} dan ${chiY}`, result, params);
                    }
                } catch (error) {
                    console.error('Terjadi kesalahan saat menjalankan uji statistik:', error);
                    alert('Terjadi kesalahan saat menjalankan uji statistik.');
                }
            });

            function getKeyByValue(object, value) {
                return Object.keys(object).find(key => object[key] === value);
            }

            function checkNormality(values) {
                // Menggunakan Uji Kolmogorov-Smirnov dari jStat
                if (values.length < 3) {
                    console.warn('Jumlah data kurang untuk uji normalitas.');
                    return false;
                }
                try {
                    const mean = jStat.mean(values);
                    const stdDev = jStat.stdev(values, true);
                    // Normalisasi data
                    const normalized = values.map(val => (val - mean) / stdDev);
                    // jStat tidak memiliki uji Kolmogorov-Smirnov secara langsung, gunakan pendekatan alternatif
                    // Sebagai alternatif, gunakan metode seperti skewness dan kurtosis untuk mengevaluasi normalitas
                    const skew = jStat.skewness(values);
                    const kurt = jStat.kurtosis(values);

                    // Ambil batas toleransi (misalnya, |skew| < 1 dan |kurt| < 3)
                    return Math.abs(skew) < 1 && Math.abs(kurt) < 3;
                } catch (error) {
                    console.error('Error saat menjalankan uji normalitas:', error);
                    return false;
                }
            }

            function checkHomogeneity(groups) {
                // Implementasi Uji Levene sederhana dengan menghitung residuals
                const groupMeans = groups.map(group => jStat.mean(group));
                const residuals = groups.flatMap((group, i) => group.map(value => Math.abs(value - groupMeans[i])));
                return checkNormality(residuals);
            }

            function calculateSlopeStdErr(x, y, slope, intercept) {
                const n = x.length;
                const residuals = y.map((yi, i) => yi - (slope * x[i] + intercept));
                const residualVariance = ss.variance(residuals);
                const sumSquares = ss.sum(x.map(xi => Math.pow(xi - ss.mean(x), 2)));
                return Math.sqrt(residualVariance / sumSquares);
            }

            function validateExpectedValues(tableArray, rowTotals, colTotals, total) {
                for (let i = 0; i < rowTotals.length; i++) {
                    for (let j = 0; j < colTotals.length; j++) {
                        const expected = (rowTotals[i] * colTotals[j]) / total;
                        if (expected < 1) {
                            alert('Nilai yang diharapkan di tabel kontingensi kurang dari 1. Chi-Square tidak valid.');
                            return false;
                        }
                    }
                }
                return true;
            }

            function displayTestResults(testType, title, results, params) {
                const summaryList = document.getElementById('summaryList');
                const li = document.createElement('li');
                const explanation = explanations[testType](results, params);
                li.innerHTML = `
                    <strong>${title}:</strong> ${getStandardReport(testType, results, params)}
                    ${explanation}
                `;
                summaryList.appendChild(li);
            }

            function getStandardReport(testType, results, params) {
                // Generate the standard report
                let report = '';
                switch(testType) {
                    case 't-test':
                        report = `T-Test menunjukkan ada perbedaan signifikan dalam efektivitas edukasi antara ${params.group1} dan ${params.group2} (p < 0.05).`;
                        break;
                    case 'correlation':
                        report = `Korelasi Pearson antara ${params.corrX} dan ${params.corrY} adalah ${results['Koefisien Korelasi Pearson']} (p < 0.05), menunjukkan hubungan yang signifikan.`;
                        break;
                    case 'anova':
                        report = `ANOVA menunjukkan ada perbedaan signifikan dalam efektivitas edukasi antara grup: ${params.groups.join(', ')} (p < 0.05).`;
                        break;
                    case 'regression':
                        report = `Regresi menunjukkan bahwa ${params.regressX} adalah prediktor signifikan efektivitas edukasi (${params.regressY}) dengan R² = ${results['R-squared']}.`;
                        break;
                    case 'chi-square':
                        report = `Chi-Square Test menunjukkan ${parseFloat(results['p-Value']) < 0.05 ? 'terdapat asosiasi signifikan' : 'tidak terdapat asosiasi signifikan'} antara ${params.chiX} dan ${params.chiY} (${parseFloat(results['p-Value']) < 0.05 ? 'p < 0.05' : 'p >= 0.05'}).`;
                        break;
                    default:
                        report = 'Hasil uji statistik.';
                }
                return report;
            }

            document.getElementById('generateChart').addEventListener('click', () => {
                const chartType = document.getElementById('chartType').value;
                const chartColumn = document.getElementById('chartColumn').value;
                const scatterY = document.getElementById('scatterY').value;
                let chartData = [];
                let labels = '';

                if (chartType === 'scatter') {
                    if (!scatterY) {
                        alert('Silakan pilih variabel Y untuk Scatter Plot.');
                        return;
                    }
                    const xValues = isEncodingEnabled 
                        ? encodedData.map(row => row[chartColumn]).filter(val => typeof val === 'number') 
                        : originalData.map(row => parseFloat(row[chartColumn])).filter(val => !isNaN(val));
                    const yValues = isEncodingEnabled 
                        ? encodedData.map(row => row[scatterY]).filter(val => typeof val === 'number') 
                        : originalData.map(row => parseFloat(row[scatterY])).filter(val => !isNaN(val));

                    if (xValues.length < 2 || yValues.length < 2) {
                        alert('Masing-masing variabel harus memiliki minimal 2 data numerik.');
                        return;
                    }

                    if (xValues.length !== yValues.length) {
                        alert('Jumlah data variabel X dan Y harus sama.');
                        return;
                    }

                    if (!checkNormality(xValues) || !checkNormality(yValues)) {
                        alert('Data tidak terdistribusi normal. Pertimbangkan menggunakan metode analisis lain.');
                        return;
                    }

                    chartData = xValues.map((x, i) => ({ x, y: yValues[i] }));
                    labels = `Scatter Plot antara ${chartColumn} dan ${scatterY}`;
                } else {
                    if (!chartColumn) {
                        alert('Silakan pilih kolom untuk visualisasi.');
                        return;
                    }
                    const dataValues = isEncodingEnabled 
                        ? encodedData.map(row => row[chartColumn]).filter(val => typeof val === 'number')
                        : originalData.map(row => parseFloat(row[chartColumn])).filter(val => !isNaN(val));

                    if (chartType === 'histogram') {
                        // Buat histogram
                        const binCount = Math.round(Math.sqrt(dataValues.length));
                        const histogram = ss.histogram(dataValues, binCount);
                        labels = `Histogram untuk ${chartColumn}`;

                        if (chartInstance) chartInstance.destroy();

                        chartInstance = new Chart(document.getElementById('chartCanvas').getContext('2d'), {
                            type: 'bar',
                            data: {
                                labels: histogram.bins.map((bin, i) => `Bin ${i + 1}`),
                                datasets: [{
                                    label: 'Frekuensi',
                                    data: histogram.bins.map(bin => bin.length),
                                    backgroundColor: 'rgba(75, 192, 192, 0.6)',
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                scales: {
                                    x: {
                                        title: {
                                            display: true,
                                            text: 'Bins'
                                        }
                                    },
                                    y: {
                                        beginAtZero: true,
                                        title: {
                                            display: true,
                                            text: 'Frekuensi'
                                        }
                                    }
                                },
                                plugins: {
                                    title: {
                                        display: true,
                                        text: labels
                                    },
                                    legend: {
                                        display: false
                                    }
                                }
                            }
                        });
                        return;
                    }

                    chartData = isEncodingEnabled 
                        ? encodedData.map(row => row[chartColumn]).filter(val => typeof val === 'number') 
                        : originalData.map(row => parseFloat(row[chartColumn])).filter(val => !isNaN(val));

                    labels = `${capitalizeFirstLetter(chartType)} untuk ${chartColumn}`;
                }

                if (chartInstance) chartInstance.destroy();

                const ctx = document.getElementById('chartCanvas').getContext('2d');

                if (chartType === 'pie') {
                    // Untuk diagram pie, kita perlu menghitung frekuensi setiap kategori
                    const originalValues = isEncodingEnabled 
                        ? originalData.map(row => row[chartColumn]).filter(val => val !== null)
                        : encodedData.map(row => row[chartColumn]).filter(val => val !== null);

                    // Jika encoding diaktifkan, map kembali ke kategori asli
                    let labelsData;
                    let dataValues;
                    if (isEncodingEnabled) {
                        // Buat inverse mapping
                        const inverseMap = {};
                        for (const [key, value] of Object.entries(encodingMaps[chartColumn] || {})) {
                            inverseMap[value] = key;
                        }
                        const mappedValues = encodedData.map(row => row[chartColumn]).filter(val => typeof val === 'number');
                        const frequency = _.countBy(mappedValues, val => inverseMap[val] || val);
                        labelsData = Object.keys(frequency);
                        dataValues = Object.values(frequency);
                    } else {
                        labelsData = _.uniq(originalValues);
                        dataValues = labelsData.map(label => _.filter(originalValues, val => val === label).length);
                    }

                    chartInstance = new Chart(ctx, {
                        type: chartType,
                        data: {
                            labels: labelsData,
                            datasets: [{
                                label: chartColumn,
                                data: dataValues,
                                backgroundColor: generateColors(labelsData.length)
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'top',
                                },
                                title: {
                                    display: true,
                                    text: `Diagram Pie untuk ${chartColumn}`
                                }
                            }
                        }
                    });
                } else if (chartType === 'scatter') {
                    chartInstance = new Chart(ctx, {
                        type: 'scatter',
                        data: {
                            datasets: [{
                                label: `${chartColumn} vs ${scatterY}`,
                                data: chartData,
                                backgroundColor: 'rgba(75, 192, 192, 0.6)'
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                x: { title: { display: true, text: chartColumn } },
                                y: { title: { display: true, text: scatterY } }
                            },
                            plugins: {
                                title: {
                                    display: true,
                                    text: `Scatter Plot antara ${chartColumn} dan ${scatterY}`
                                },
                                legend: {
                                    display: false
                                }
                            }
                        }
                    });
                } else {
                    // Untuk bar, line charts
                    // Jika chartType adalah 'bar' atau 'line', buat grafik sesuai
                    // Jika data kategorikal, gunakan frekuensi
                    let labelsData;
                    let dataValues;
                    if (isEncodingEnabled) {
                        // Map kembali ke kategori asli jika memungkinkan
                        const inverseMap = {};
                        for (const [key, value] of Object.entries(encodingMaps[chartColumn] || {})) {
                            inverseMap[value] = key;
                        }
                        const mappedValues = encodedData.map(row => row[chartColumn]).filter(val => typeof val === 'number');
                        const frequency = _.countBy(mappedValues, val => inverseMap[val] || val);
                        labelsData = Object.keys(frequency);
                        dataValues = Object.values(frequency);
                    } else {
                        const originalValues = originalData.map(row => row[chartColumn]).filter(val => val !== null);
                        labelsData = _.uniq(originalValues);
                        dataValues = labelsData.map(label => _.filter(originalValues, val => val === label).length);
                    }

                    chartInstance = new Chart(ctx, {
                        type: chartType,
                        data: {
                            labels: labelsData,
                            datasets: [{
                                label: chartColumn,
                                data: dataValues,
                                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                                borderColor: 'rgba(54, 162, 235, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            },
                            plugins: {
                                title: {
                                    display: true,
                                    text: `${capitalizeFirstLetter(chartType)} untuk ${chartColumn}`
                                },
                                legend: {
                                    display: false
                                }
                            }
                        }
                    });
                }
            });

            function generateColors(num) {
                const colors = [];
                for (let i = 0; i < num; i++) {
                    const r = Math.floor(Math.random() * 255);
                    const g = Math.floor(Math.random() * 255);
                    const b = Math.floor(Math.random() * 255);
                    colors.push(`rgba(${r}, ${g}, ${b}, 0.6)`);
                }
                return colors;
            }

            function capitalizeFirstLetter(string) {
                return string.charAt(0).toUpperCase() + string.slice(1);
            }

            // Export CSV
            document.getElementById('exportCSV').addEventListener('click', () => {
                const headers = tableColumns.map(col => col.title).join(',');
                const rows = (isEncodingEnabled ? encodedData : originalData).map(row => tableColumns.map(col => {
                    const value = row[col.title];
                    // Escape double quotes dan bungkus dalam tanda kutip jika perlu
                    if (typeof value === 'string' && (value.includes(',') || value.includes('"') || value.includes('\n'))) {
                        return `"${value.replace(/"/g, '""')}"`;
                    }
                    return value;
                }).join(',')).join('\n');
                const csvContent = `${headers}\n${rows}`;

                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', 'data_export.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });

            // Export PDF
            document.getElementById('exportPDF').addEventListener('click', () => {
                const container = document.querySelector('.container');
                html2canvas(container).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
                    const imgProps = pdf.getImageProperties(imgData);
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                    pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                    pdf.save('laporan.pdf');
                });
            });

            // Saran Uji Statistik
            function suggestStatisticalTests() {
                const numericalCols = getNumericalColumns();
                const categoricalCols = getCategoricalColumns();

                let suggestions = [];

                if (numericalCols.length >= 2) {
                    suggestions.push('T-Test: Membandingkan rata-rata dua grup numerik.');
                    suggestions.push('Korelasi Pearson: Mengukur hubungan linier antara dua variabel numerik.');
                    suggestions.push('Regresi: Memprediksi nilai variabel dependen berdasarkan variabel independen.');
                    suggestions.push('ANOVA: Membandingkan rata-rata lebih dari dua grup numerik.');
                }

                if (categoricalCols.length >= 2) {
                    suggestions.push('Chi-Square: Menguji asosiasi antara dua variabel kategorikal.');
                }

                if (suggestions.length > 0) {
                    alert('Berdasarkan data yang diunggah, berikut adalah uji statistik yang dapat Anda gunakan:\n\n' + suggestions.join('\n'));
                } else {
                    alert('Data yang diunggah tidak memenuhi kriteria untuk uji statistik yang tersedia.');
                }
            }

            function displayEncodingMappings() {
                const mappingsDiv = document.getElementById('encodingMappings');
                mappingsDiv.innerHTML = ''; // Clear previous mappings

                for (const [column, mapping] of Object.entries(encodingMaps)) {
                    let html = `<h5>Mapping untuk <strong>${column}</strong></h5>`;
                    html += `<table class="table table-bordered"><thead><tr><th>Kategori</th><th>Numerik</th></tr></thead><tbody>`;
                    for (const [category, num] of Object.entries(mapping)) {
                        html += `<tr><td>${category}</td><td>${num}</td></tr>`;
                    }
                    html += `</tbody></table>`;
                    mappingsDiv.innerHTML += html;
                }

                // Show the modal using Bootstrap's Modal API
                const encodingModalElement = document.getElementById('encodingModal');
                const encodingModal = new bootstrap.Modal(encodingModalElement, {
                    keyboard: false
                });
                encodingModal.show();
            }

            // Event listener for encoding checkbox
            document.getElementById('enableEncoding').addEventListener('change', function () {
                // Jika file sudah diunggah, re-parse dengan pengaturan encoding baru
                if (originalData.length > 0) {
                    const csvContent = convertDataToCSV(originalData);
                    Papa.parse(csvContent, {
                        header: true,
                        delimiter: "\t", // Asumsi delimiter tab saat encoding diaktifkan
                        skipEmptyLines: true,
                        complete: function(results) {
                            if (results.errors.length) {
                                alert('Terjadi kesalahan saat parsing ulang file CSV: ' + results.errors[0].message);
                                console.error(results.errors);
                                return;
                            }
                            parseCSV(results.data);
                        }
                    });
                }
            });

            function convertDataToCSV(data) {
                if (data.length === 0) return '';

                const headers = Object.keys(data[0]);
                const rows = data.map(row => headers.map(header => row[header] !== null ? row[header] : '').join('\t')).join('\n');
                return `${headers.join('\t')}\n${rows}`;
            }

            // Modal Event Listeners untuk Verifikasi
            const encodingModalElement = document.getElementById('encodingModal');
            encodingModalElement.addEventListener('shown.bs.modal', function () {
                console.log('Modal encoding ditampilkan.');
                // Pastikan aria-hidden dihapus saat modal ditampilkan
                this.setAttribute('aria-hidden', 'false');
            });

            encodingModalElement.addEventListener('hidden.bs.modal', function () {
                console.log('Modal encoding disembunyikan.');
                // Pastikan aria-hidden ditambahkan kembali saat modal disembunyikan
                this.setAttribute('aria-hidden', 'true');
            });

            // Implementasi Levene's Test (Perlu Library Tambahan atau Implementasi Manual)
            // Karena jStat belum menyediakan fungsi langsung untuk Levene's Test, Anda bisa mengimplementasikan secara manual
            jStat.levenesTest = function(...args) {
                const alpha = args.pop(); // Ambil nilai alpha dari argumen terakhir
                const groups = args;
                const groupMeans = groups.map(group => jStat.mean(group));
                const residuals = groups.flatMap((group, i) => group.map(value => Math.abs(value - groupMeans[i])));
                const overallMean = jStat.mean(residuals);
                const ssBetween = residuals.reduce((acc, dev) => acc + Math.pow(dev - overallMean, 2), 0);
                const ssWithin = residuals.reduce((acc, dev) => acc + Math.pow(dev, 2), 0);
                const dfBetween = groups.length - 1;
                const dfWithin = residuals.length - groups.length;
                const f = (ssBetween / dfBetween) / (ssWithin / dfWithin);
                const pValue = 1 - jStat.f.cdf(f, dfBetween, dfWithin);
                return { statistic: f, pValue: pValue };
            };
        });
    </script>
</body>
</html>
